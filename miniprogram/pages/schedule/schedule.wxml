<!--schedule.wxml-->
<navigation-bar
  title="è¯¾ç¨‹è¡¨"
  back="{{true}}"
  color="#1f2d3d"
  background="#ffffff"
>
</navigation-bar>
<view class="schedule-container">

  
  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="schedule-header">
    <view class="title-row">
      <text class="schedule-title">æˆ‘çš„è¯¾ç¨‹</text>
      <view class="add-btn" bindtap="onAddTap">
        <text class="plus-icon">ï¼‹</text>
        <text class="plus-text">æ·»åŠ </text>
      </view>
    </view>
    <text class="schedule-subtitle">æŸ¥çœ‹å’Œç®¡ç†æ¯å‘¨è¯¾ç¨‹å®‰æ’</text>
  </view>

  <!-- æ˜ŸæœŸé€‰æ‹©å™¨ -->
  <view class="weekday-selector">
    <view 
      wx:for="{{weekdays}}" 
      wx:key="weekday"
      class="weekday-btn {{item.isActive ? 'active' : ''}}"
      data-weekday="{{item.weekday}}"
      bindtap="onWeekdayTap"
    >
      <text class="weekday-short">{{item.shortName}}</text>
      <text class="weekday-date">{{item.date}}</text>
    </view>
  </view>

  <!-- è¯¾ç¨‹å†…å®¹åŒºåŸŸ -->
  <view class="schedule-content">
    <!-- æ— è¯¾ç¨‹çŠ¶æ€ -->
    <view wx:if="{{!daySchedule || daySchedule.courses.length === 0}}" class="empty-state">
      <text class="smiley-icon">ğŸ˜Š</text>
      <text class="empty-text">ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹
å¥½å¥½æ”¾æ¾ï¼Œäº«å—è‡ªç”±æ—¶å…‰ï¼</text>
    </view>

    <!-- è¯¾ç¨‹åˆ—è¡¨ -->
    <view wx:else class="course-list">
      <view 
        wx:for="{{daySchedule.courses}}" 
        wx:key="id"
        class="course-card"
        style="border-left-color: {{item.color}}"
        data-id="{{item.id}}"
        data-weekday="{{daySchedule.weekday}}"
        bindtap="onCourseCardTap"
      >
        <view class="course-info">
          <!-- å·¦ä¾§æ—¶é—´ä¿¡æ¯ -->
          <view class="time-section">
            <text class="lesson-range">ç¬¬{{item.startLesson}}-{{item.endLesson}}èŠ‚</text>
            <text class="time-range">{{item.startTime}}-{{item.endTime}}</text>
          </view>

          <!-- å³ä¾§è¯¾ç¨‹è¯¦æƒ… -->
          <view class="course-details">
            <text class="course-name">{{item.name}}</text>
            <view class="course-meta">
              <view class="meta-item">
                <text class="meta-icon">ğŸ“</text>
                <text class="meta-text">{{item.location}}</text>
              </view>
              <view class="meta-item">
                <text class="meta-icon">ğŸ‘¨â€ğŸ«</text>
                <text class="meta-text">{{item.teacher}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ èœå•é®ç½© -->
  <view wx:if="{{showAddMenu}}" class="add-menu-overlay" bindtap="hideAddMenu">
    <view class="add-menu" catchtap="stopPropagation">
      <text class="menu-title">é€‰æ‹©æ“ä½œ</text>
      <view class="menu-options">
        <view class="menu-option" bindtap="onImportSchedule">
          <view class="option-icon">ğŸ“¥</view>
          <text class="option-text">å¯¼å…¥è¯¾è¡¨</text>
        </view>
        <view class="menu-option" bindtap="onAddCourse">
          <view class="option-icon">â•</view>
          <text class="option-text">æ·»åŠ è¯¾ç¨‹</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯¼å…¥è¯¾è¡¨å¼¹çª— -->
  <view wx:if="{{showImportModal}}" class="modal-overlay" bindtap="onCancelImport">
    <view class="modal-content import" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ä»å…¶ä»–APPå¯¼å…¥</text>
        <text class="modal-close" bindtap="onCancelImport">âœ•</text>
      </view>
      <view class="modal-body">
        <text class="modal-tip">åœ¨å…¶å®ƒè¯¾è¡¨APPä¸­å¤åˆ¶å¯¼å‡ºçš„JSONæ•°æ®ï¼Œå¹¶ç²˜è´´åˆ°ä¸‹æ–¹ã€‚</text>
        <textarea
          class="import-textarea"
          placeholder='[{"weekday":1,"name":"å¿ƒç†å­¦å¯¼è®º","startLesson":1,"endLesson":2,"startTime":"08:00","endTime":"09:40","location":"å—åŒº302","teacher":"è‹è€å¸ˆ"}]'
          value="{{importText}}"
          bindinput="onImportTextInput"
          maxlength="-1"
        />
        <text class="error-text" wx:if="{{importError}}">{{importError}}</text>
        <button class="sample-btn" bindtap="onUseImportSample">ä½¿ç”¨ç¤ºä¾‹æ•°æ®</button>
      </view>
      <view class="modal-footer">
        <button class="modal-btn ghost" bindtap="onCancelImport">å–æ¶ˆ</button>
        <button class="modal-btn primary" bindtap="onConfirmImport">å¯¼å…¥</button>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘è¯¾ç¨‹å¼¹çª— -->
  <view wx:if="{{showCourseModal}}" class="modal-overlay" bindtap="onCourseModalCancel">
    <view class="modal-content course" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{editingCourseId ? 'ç¼–è¾‘è¯¾ç¨‹' : 'æ·»åŠ è¯¾ç¨‹'}}</text>
        <text class="modal-close" bindtap="onCourseModalCancel">âœ•</text>
      </view>
      <view class="modal-body course-form">
        <view class="form-row">
        <text class="form-label">æ˜ŸæœŸ</text>
        <picker
          mode="selector"
          range="{{pickerWeekLabels}}"
          bindchange="onCourseWeekdayChange"
        >
          <view class="picker-value">{{weekdayLabels[courseForm.weekday]}}</view>
        </picker>
        </view>
        <view class="form-row">
          <text class="form-label">è¯¾ç¨‹åç§°</text>
          <input class="form-input" value="{{courseForm.name}}" data-field="name" bindinput="onCourseFormInput" placeholder="è¯·è¾“å…¥åç§°" />
        </view>
        <view class="form-row">
          <text class="form-label">ä¸Šè¯¾åœ°ç‚¹</text>
          <input class="form-input" value="{{courseForm.location}}" data-field="location" bindinput="onCourseFormInput" placeholder="æ•™å­¦æ¥¼/æ•™å®¤" />
        </view>
        <view class="form-row">
          <text class="form-label">æˆè¯¾è€å¸ˆ</text>
          <input class="form-input" value="{{courseForm.teacher}}" data-field="teacher" bindinput="onCourseFormInput" placeholder="æ•™å¸ˆå§“å" />
        </view>
        <view class="form-row two-cols">
          <view class="form-col">
            <text class="form-label">å¼€å§‹èŠ‚æ¬¡</text>
            <input class="form-input" value="{{courseForm.startLesson}}" data-field="startLesson" bindinput="onCourseFormNumberInput" type="number" />
          </view>
          <view class="form-col">
            <text class="form-label">ç»“æŸèŠ‚æ¬¡</text>
            <input class="form-input" value="{{courseForm.endLesson}}" data-field="endLesson" bindinput="onCourseFormNumberInput" type="number" />
          </view>
        </view>
        <view class="form-row two-cols">
          <view class="form-col">
            <text class="form-label">å¼€å§‹æ—¶é—´</text>
            <input class="form-input" value="{{courseForm.startTime}}" data-field="startTime" bindinput="onCourseFormInput" placeholder="08:00" />
          </view>
          <view class="form-col">
            <text class="form-label">ç»“æŸæ—¶é—´</text>
            <input class="form-input" value="{{courseForm.endTime}}" data-field="endTime" bindinput="onCourseFormInput" placeholder="09:40" />
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn ghost" bindtap="onCourseModalCancel">å–æ¶ˆ</button>
        <button wx:if="{{editingCourseId}}" class="modal-btn danger" bindtap="onCourseDelete">åˆ é™¤</button>
        <button class="modal-btn primary" bindtap="onCourseModalSubmit">{{editingCourseId ? 'ä¿å­˜ä¿®æ”¹' : 'æ·»åŠ è¯¾ç¨‹'}}</button>
      </view>
    </view>
  </view>
</view>