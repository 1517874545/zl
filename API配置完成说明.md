# API配置完成说明

## ✅ 配置状态

### 1. 和风天气API
- **API Key**: `5157c47b70ae4e2ca6517bb8ec621512`
- **状态**: ✅ 已配置
- **使用方式**: 直接调用（开发测试）
- **功能**: 
  - 当前天气查询
  - 7天天气预报
  - 空气质量查询

### 2. 豆包（火山引擎）AI API
- **API Key**: `2def65ad-06c6-4a41-87ee-fe1c99763d92`
- **模型ID**: `deepseek-v3-2-251201`
- **API地址**: `https://ark.cn-beijing.volces.com/api/v3/responses`
- **状态**: ✅ 已配置
- **使用方式**: 直接调用（开发测试）
- **功能**: AI对话助手

## 📝 配置文件位置

所有配置在 `miniprogram/utils/config.ts` 文件中：

```typescript
weather: {
  qweatherKey: '5157c47b70ae4e2ca6517bb8ec621512',
  useMockData: false,  // 使用真实API
  directCall: true,    // 直接调用（开发测试）
}

ai: {
  apiKey: '2def65ad-06c6-4a41-87ee-fe1c99763d92',
  modelId: 'deepseek-v3-2-251201',
  apiUrl: 'https://ark.cn-beijing.volces.com/api/v3/responses',
  useMockData: false,  // 使用真实API
  directCall: true,    // 直接调用（开发测试）
}
```

## 🚀 现在可以测试

### 天气功能测试
1. 打开小程序
2. 点击首页"天气"按钮
3. 查看当前天气（真实数据）
4. 查看7天天气预报（真实数据）
5. 尝试添加城市、切换城市

### AI助手功能测试
1. 打开小程序
2. 点击首页"AI助手"按钮
3. 发送消息测试AI回复
4. 查看对话历史

## ⚠️ 重要提醒

### 安全性警告
**当前配置是直接调用API，API密钥暴露在小程序代码中。**

这是**不安全的做法**，仅适用于：
- ✅ 开发测试阶段
- ✅ 个人项目
- ❌ **不适合生产环境**

### 生产环境建议

如果要将小程序发布到生产环境，**必须**：

1. **搭建服务器代理**
   - 将API密钥存储在服务器端
   - 小程序通过服务器代理调用API
   - 保护API密钥不被泄露

2. **修改配置**
   ```typescript
   weather: {
     apiProxy: 'https://your-server.com/api/weather',
     directCall: false,  // 改为false，使用代理
   }
   
   ai: {
     apiProxy: 'https://your-server.com/api/ai',
     directCall: false,  // 改为false，使用代理
   }
   ```

3. **参考文档**
   - 查看 `API配置说明.md` 了解如何搭建服务器代理

## 🔧 如果遇到问题

### 天气API问题
- **城市找不到**: 确保城市名称正确（如"北京"、"上海"）
- **数据为空**: 检查网络连接，查看控制台错误信息
- **API限制**: 和风天气免费版有调用次数限制

### AI API问题
- **返回错误**: 检查API Key是否正确
- **模型不可用**: 确认模型ID `deepseek-v3-2-251201` 是否可用
- **网络超时**: 检查网络连接，AI回复可能需要较长时间

### 调试方法
1. 打开微信开发者工具
2. 查看控制台（Console）的错误信息
3. 检查网络请求（Network）是否成功
4. 查看返回数据格式是否正确

## 📊 API使用情况

### 和风天气API
- **免费额度**: 每天1000次调用
- **计费方式**: 超出后按量付费
- **建议**: 合理使用，避免频繁刷新

### 豆包AI API
- **免费额度**: 50万tokens免费
- **计费方式**: 超出后按量付费
- **建议**: 控制对话长度，避免浪费tokens

## ✅ 测试清单

- [ ] 天气功能：查看当前天气
- [ ] 天气功能：查看7天预报
- [ ] 天气功能：添加城市
- [ ] 天气功能：切换城市
- [ ] AI助手：发送消息
- [ ] AI助手：查看回复
- [ ] AI助手：查看历史记录
- [ ] 检查网络请求是否成功
- [ ] 检查数据格式是否正确

## 🎉 完成

所有API已配置完成，可以开始测试了！

如果测试过程中遇到任何问题，请查看控制台错误信息或联系我。

