# 微信小程序域名配置说明

## 🔍 问题

天气功能使用的和风天气API域名未在微信公众平台配置，导致请求被拦截。

## ✅ 需要添加的域名

### 和风天气API域名

需要在微信公众平台的 **request合法域名** 中添加以下域名：

1. **`https://geoapi.qweather.com`** - 城市查询API
2. **`https://devapi.qweather.com`** - 天气数据API

## 📝 配置步骤

### 1. 登录微信公众平台

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 使用管理员账号登录
3. 进入你的小程序管理后台

### 2. 配置服务器域名

1. 在左侧菜单找到 **开发** → **开发管理** → **开发设置**
2. 找到 **服务器域名** 部分
3. 点击 **request合法域名** 右侧的 **修改** 按钮
4. 添加以下域名：
   ```
   https://geoapi.qweather.com
   https://devapi.qweather.com
   ```
5. 点击 **保存** 按钮

### 3. 等待生效

- 域名配置后可能需要 **几分钟到几小时** 才能生效
- 建议等待10-30分钟后重新测试

### 4. 重新编译小程序

- 在微信开发者工具中点击 **编译** 按钮
- 或者清除缓存后重新编译

## 📋 当前已配置的域名（参考）

根据之前的配置，你的小程序应该已经配置了以下域名：

- `https://mvzpegvtiafzzznzvdqx.supabase.co` - Supabase数据库
- `https://ark.cn-beijing.volces.com` - 火山引擎（豆包AI）
- `https://tcb-api.tencentcloudapi.com` - 腾讯云API

## ⚠️ 注意事项

1. **域名格式**
   - 必须包含 `https://` 协议
   - 不能包含路径，只能到域名级别
   - 例如：`https://geoapi.qweather.com` ✅
   - 错误：`https://geoapi.qweather.com/v2` ❌

2. **开发环境**
   - 在微信开发者工具中，可以勾选 **"不校验合法域名"** 来临时测试
   - 但正式发布前必须配置合法域名

3. **域名数量限制**
   - 每个小程序最多可配置20个request合法域名
   - 如果超出限制，需要删除不用的域名

## 🔧 临时解决方案（仅开发测试）

如果暂时无法配置域名，可以在微信开发者工具中：

1. 点击右上角 **详情** 按钮
2. 在 **本地设置** 中勾选：
   - ✅ **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**
3. 重新编译小程序

**注意：** 这只是开发环境的临时方案，正式发布前必须配置合法域名。

## ✅ 配置完成后

配置完成并生效后：

1. 重新编译小程序
2. 测试天气功能：
   - 打开天气页面
   - 查看是否能正常加载天气数据
   - 测试添加城市功能
   - 检查控制台是否还有域名错误

---

**配置日期：** 2025-01-13  
**相关功能：** 天气模块
